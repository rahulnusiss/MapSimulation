<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1"/>
		<title>
			Mera Naksha
		</title>
		<!--Leaflet-->
		<link rel="stylesheet" href="lib/leaflet/leaflet.css"/>
		<link rel="stylesheet" href="lib/leaflet/routing/leaflet-routing-machine.css"/>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
		<script src="lib/leaflet/leaflet.js"></script>
		<script src="data/countries.geojson"></script>
		<script src="lib/leaflet/routing/leaflet-routing-machine.js"></script>
		<script src="lib/leaflet/routing/lrm-graphhopper.js"></script>
		<style type="text/css">
			#map{ height : 400px;}
			.legend{ background : white; line-height : 1.5em}
			.legend i { width :5em; float : left }
		</style>
		<style>
			.map {
				position: absolute;
				width: 100%;
				height: 100%;
			}
		</style>
	</head>
	<body>
		<h1>Naksha</h1>
		<form id="mapFormId">
			Distance :
			<input id="distanceBox" type="text" name="Fname">
		</form>
		<div id="map" class ="map"></div>	
		<script>
			<!-- Add countries in map -->
			var map = L.map('map').setView([43.8476,18.3564], 6);
			//var countriesLayer = L.geoJson(countries).addTo(map);
			
			<!-- Legends -->
			var legend = L.control({position : 'bottomright'});
			legend.onAdd = function(map){
				var div = L.DomUtil.create('div','legend');
				var labels = ["Teams", "Support staff", "Pitstop"];
				var grades = ['Green', 'Blue', 'Red'];
				div.innerHTML = '<div><b>Legend</b></div>';
				for( var i =0; i < grades.length; ++i)
				{
					div.innerHTML += '<i style ="background:' +
					grades[i] +'">&nbsp;&nbsp;</i>&nbsp;&nbsp;' +
					labels[i] + '<br/>';
				}
				return div;
			}
			legend.addTo(map);
			
			<!-- Add Markers in map -->
			var point1 = [43.86667, 18.566644];
			var point2 = [20.89963, 89.35665];
			var iconPoint2 = L.icon (
			{
				iconUrl:'MapMarker_Ball__Azure.png',
				iconSize: [20,20],
				iconAnchor : [22,94],
				popupAnchor : [-3,-76]
			});
			var point3 = [5.89963, 112.35665];
			var iconPoint3 = L.icon (
			{
				iconUrl:'MapMarker_Ball__Chartreuse.png',
				iconSize: [20,20],
				iconAnchor : [22,94],
				popupAnchor : [-3,-76]
			});
			var marker1 = L.marker(point1).addTo(map);
			var marker2 = L.marker(point2,{icon : iconPoint2}).addTo(map);
			var marker3 = L.marker(point3,{icon : iconPoint3}).addTo(map);
			
			<!-- Routing -- >
			var i = 0;
			var finish = 0;
			var routeControl = null;
			var coordArr = {} ;
			
			<!-- 1st way  From 1 to 2-- >
			var latitude1 = 1.3046014;
			var longitude1 = 103.7701238;
			var latitude2 = 1.2838627;
			var longitude2 = 103.8493554;
			var startMarker = L.marker([latitude1, longitude1], { draggable: false}).addTo(map);
			var endMarker = L.marker([latitude2, longitude2], { draggable: false}).addTo(map);
			
			var startMarkerTeam2 = L.marker([latitude1, longitude1], { draggable: false}).addTo(map);
			var startMarkerTeam3 = L.marker([latitude1, longitude1], { draggable: false}).addTo(map);
			
			<!-- 2nd way, From 2 to 3 -- >
			var routeControl2 = null;
			var coordArr2 = {} ;
			var latitude3 = 1.300599;
			var longitude3 = 103.8527043;
			var startMarker2 = L.marker([latitude2, longitude2], { draggable: false}).addTo(map);
			var endMarker2 = L.marker([latitude3, longitude3], { draggable: false}).addTo(map);
			
			<!-- 3rd way From 3 to 4-- >
			var routeControl3 = null;
			var coordArr3 = {} ;
			var latitude4 = 1.3075337;
			var longitude4 = 103.8609886;
			var startMarker3 = L.marker([latitude3, longitude3], { draggable: false}).addTo(map);
			var endMarker3 = L.marker([latitude4, longitude4], { draggable: false}).addTo(map);
			
			function routeImpl(){
			L.tileLayer( 'http://{s}.tile.osm.org/{z}/{x}/{y}{r}.png', {
				attribution: 'Â© OpenStreetMap contributors'
			}).addTo(map);			
			
			if ( null == routeControl ){
				//Create route control
				routeControl = L.Routing.control({
				waypoints: [
				L.latLng(latitude1, longitude1),
				L.latLng(latitude2, longitude2)
				],
				createMarker: function(i, waypoint, n){
					if ( 0 == i ){return startMarker;}
					return endMarker;
				},
				routeWhileDragging: true,
				router: L.Routing.graphHopper('49b2a42d-a150-46bc-9edc-e60a10a781fd')
				//geocoder: L.Control.Geocoder.nominatim()
			}).addTo(map);}	
			
			if ( null == routeControl2 ){
				//Create route control
				routeControl2 = L.Routing.control({
				waypoints: [
				L.latLng(latitude2, longitude2),
				L.latLng(latitude3, longitude3)
				],
				createMarker: function(i, waypoint, n){
					if ( 0 == i ){return startMarker2;}
					return endMarker2;
				},
				routeWhileDragging: true,
				router: L.Routing.graphHopper('49b2a42d-a150-46bc-9edc-e60a10a781fd')
				//geocoder: L.Control.Geocoder.nominatim()
			}).addTo(map);}
			
			if ( null == routeControl3 ){
				//Create route control
				routeControl3 = L.Routing.control({
				waypoints: [
				L.latLng(latitude3, longitude3),
				L.latLng(latitude4, longitude4)
				],
				createMarker: function(i, waypoint, n){
					if ( 0 == i ){return startMarker3;}
					return endMarker3;
				},
				routeWhileDragging: true,
				router: L.Routing.graphHopper('49b2a42d-a150-46bc-9edc-e60a10a781fd')
				//geocoder: L.Control.Geocoder.nominatim()
			}).addTo(map);}	
			// override		
						
			routeControl.on('routesfound', function(e) {
			var routes = e.routes;				
			var distance = routes[0].summary.totalDistance;
			$('#distanceBox').val(distance/1000);
			coordArr = routes[0].coordinates.slice();				
			});	
			
			routeControl2.on('routesfound', function(e) {
			var routes = e.routes;				
			var distance = routes[0].summary.totalDistance;
			$('#distanceBox').val(distance/1000);
			coordArr2 = routes[0].coordinates.slice();				
			});			
			
			routeControl3.on('routesfound', function(e) {
			var routes = e.routes;				
			var distance = routes[0].summary.totalDistance;
			$('#distanceBox').val(distance/1000);
			coordArr3 = routes[0].coordinates.slice();				
			});
			setTimeout(displaceMarker, 2000);	
			}		
			
			var displaceMarker = function(){				
				var newLatlng = L.latLng(coordArr[i].lat, coordArr[i].lng);
				if( !(newLatlng.equals(L.latLng(latitude2, longitude2)) ) )
				{								
					startMarker.setLatLng(newLatlng);
					startMarker.addTo(map);
					//e.waypoints[0].latLng
					++i;
					console.log('i =',i);
					if ( 0 == finish ){
						setTimeout(displaceMarker, 500);
					}
					else{						
						raceFinish;					
					}
				}
				if( i == coordArr.length ){
					i = 0;
					startMarker.setLatLng(L.latLng(latitude2, longitude2));
					startMarker.addTo(map);
					console.log('coordArr2.length',coordArr2.length);
					setTimeout(displaceMarker2, 500);
				}
				
				
			}
			
			var displaceMarker2 = function(){				
				
				var newLatlng = L.latLng(coordArr2[i].lat, coordArr2[i].lng);
				if( !(newLatlng.equals(L.latLng(latitude3, longitude3)) ) )
				{				
					startMarker.setLatLng(newLatlng);
					startMarker.addTo(map);
					//e.waypoints[0].latLng
					i = i + 1;
					console.log('i =',i);
					if ( 0 == finish ){
						setTimeout(displaceMarker2, 500);
					}
					else{						
						raceFinish;					
					}					
				}
				if( i == coordArr2.length ){
					i = 0;
					startMarker.setLatLng(L.latLng(latitude3, longitude3));
					startMarker.addTo(map);
					console.log('coordArr3.length',coordArr3.length);
					setTimeout(displaceMarker3, 500);
				}
				
			}
			
			var displaceMarker3 = function(){
				
				
				var newLatlng = L.latLng(coordArr3[i].lat, coordArr3[i].lng);				
				if( !(newLatlng.equals(L.latLng(latitude4, longitude4)) ) )
				{							
					startMarker.setLatLng(newLatlng);
					startMarker.addTo(map);
					//e.waypoints[0].latLng
					++i;
					if ( 0 == finish ){
						setTimeout(displaceMarker3, 500);
					}
					else{						
						raceFinish;					
					}					
				}	
				if( i == (coordArr3.length-1) ){
					finish = 1;
					console.log('Should Finish', finish);
					throw new Error("Something went badly wrong!");					
				}				
			}
			
			var raceFinish = function(){
				throw new Error("Race Finish!");
			}
			routeImpl();
		</script>
	</body>
</html>
